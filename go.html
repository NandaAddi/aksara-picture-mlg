<script>
    // Gunakan konfigurasi yang sama dengan admin.html
    const SUPABASE_URL = 'https://rgeshbeiweqnnkbhgoya.supabase.co';
    const SUPABASE_KEY = 'YOUR_ANON_KEY_KAMU'; 
    const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    async function doRedirect() {
        const params = new URLSearchParams(window.location.search);
        const code = params.get('c');

        if (!code) {
            console.error("Tidak ada kode ditemukan di URL");
            window.location.href = 'https://aksara-picture-mlg.vercel.app/';
            return;
        }

        // Ambil data dari tabel short_links
        const { data, error } = await sb
            .from('short_links')
            .select('*')
            .eq('short_code', code)
            .single();

        if (error || !data) {
            console.error("Link tidak ditemukan di database:", error);
            // Jika error, kembali ke home
            window.location.href = 'https://aksara-picture-mlg.vercel.app/';
            return;
        }

        // Update jumlah klik secara background
        await sb.rpc('increment_clicks', { row_id: data.id }).catch(() => {
            // Jika rpc gagal, pakai update biasa
            sb.from('short_links').update({ clicks: (data.clicks || 0) + 1 }).eq('id', data.id);
        });

        // Redirect ke link asli
        window.location.href = data.original_url;
    }

    doRedirect();
</script>
